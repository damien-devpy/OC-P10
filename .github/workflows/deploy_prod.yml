name: Deploy to production

on:
  push:
    branches:
      - Setup-CD

jobs:

  build:
#    env:
#      DATABASE_PASSWORD: 'my_db_password'
#      SECRET_KEY: 'my_secret_key'
#      ENV: development
#      MOZ_HEADLESS: 1

    # The type of runner that the job will run on
    runs-on: ubuntu-latest

#    services:
#      postgres:
#        image: postgres
#        env:
#          POSTGRES_DB: 'purbeurre_db'
#          POSTGRES_USER: 'purbeurre_db_admin'
#          POSTGRES_PASSWORD: 'my_db_password'
#        ports:
#          - 5432:5432
#
    steps:
#
#      - uses: actions/checkout@v2
#
#      - name: Setup Python 3.8
#        uses: actions/setup-python@v2
#        with:
#          python-version: '3.8'
#
#      - name: Install dependencies
#        run: |
#          pip install pipenv
#          pipenv install --dev
#
#      - name: Install Geckodriver
#        run: |
#          wget https://github.com/mozilla/geckodriver/releases/download/v0.28.0/geckodriver-v0.28.0-linux64.tar.gz
#          mkdir geckodriver
#          tar -xzf geckodriver-v0.28.0-linux64.tar.gz -C geckodriver
#          export PATH=$PATH:$PWD/geckodriver
#
#      - name: Running tests
#        run: pipenv run pytest --driver Firefox

      - name: Create SSH keys
        run: |
          mkdir -p ~/.ssh/
          cd ~/.ssh/
          echo "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDkuA8W+LNkx0cW4AhryH28WfQfdVS9LxlJXGrtxxT8C2MTC1+xa/sspzAdIdoGzAR7I1rBYE1D6j7pGxFTiKWRbVBYW3wciBPLfJ3mD8eStlQTfCFXcMK1CZ0LdUiyIAOMUQW0BU1tgtJ9PJCfE+umMaNA+rjuBEU64hR5BqAJyI+l4Jvw2RT4vmruZnMv+4t9kM5/Yq2bJIk6ktkvqPhUbwzudoSmLMlioFIea9K/V10RqstJLoTDNdFXYP9uj1znr21JMy9RIzjFZicQPtU+d/1PnzZJnyZmp4yzR0DYEQsvuLNLFHVYR52HriLHMaOWSAqrgs9L8KG/6jxW1nU0RHHhp4BPhbflJvg6SiZQx5qt82DpiCAye450ORAqqwRO6kMko56t36ILeG3i7fACNVuow3E47Z02nhk+sRCAE+ff2za4K1Cb0MZLzgNnKQJOeS0X+5Y8fcqpdmfzaV0a54vSDrdA2IMJSxt/76gtn8GzoqjjmYboRhr26jxA2JI4ZoBajJlCbmBo6AVo4j3HXBexlEuZOpBXnQQNR8UNtZmbqnk0U+CHm1HurmSOfaeHsnFe+ank+lakQGNVnDVuZfrTmpwdwWlEzi3lzlkotCoy1Noa5lWdx2pXIwiadzY1v02GR1FrGPqOzwLGd0H9QjaklB85JMr2giiuL4vOUw== damien.ramelet@protonmail.com" > id_rsa.pub

      - name: Deploy to production
        run: |
          ssh -tto StrictHostKeyChecking=no damien@51.159.190.2
          "cd OC-P8 && git pull origin master && pipenv shell && python manage.py collectstatic --noinput && python manage.py makemigrations && python manage.py migrate && exit"


