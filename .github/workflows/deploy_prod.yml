name: Deploy to production

on:
  push:
    branches:
      - Setup-CD

jobs:

  build:
#    env:
#      DATABASE_PASSWORD: 'my_db_password'
#      SECRET_KEY: 'my_secret_key'
#      ENV: development
#      MOZ_HEADLESS: 1

    # The type of runner that the job will run on
    runs-on: ubuntu-latest

#    services:
#      postgres:
#        image: postgres
#        env:
#          POSTGRES_DB: 'purbeurre_db'
#          POSTGRES_USER: 'purbeurre_db_admin'
#          POSTGRES_PASSWORD: 'my_db_password'
#        ports:
#          - 5432:5432
#
    steps:
#
#      - uses: actions/checkout@v2
#
#      - name: Setup Python 3.8
#        uses: actions/setup-python@v2
#        with:
#          python-version: '3.8'
#
#      - name: Install dependencies
#        run: |
#          pip install pipenv
#          pipenv install --dev
#
#      - name: Install Geckodriver
#        run: |
#          wget https://github.com/mozilla/geckodriver/releases/download/v0.28.0/geckodriver-v0.28.0-linux64.tar.gz
#          mkdir geckodriver
#          tar -xzf geckodriver-v0.28.0-linux64.tar.gz -C geckodriver
#          export PATH=$PATH:$PWD/geckodriver
#
#      - name: Running tests
#        run: pipenv run pytest --driver Firefox

      - name: Create SSH keys
        run: |
          mkdir -p ~/.ssh/
          cd ~/.ssh/
          echo "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDZh5cqdVgrN/tAtG6jZzVgtciJS4G0nQN9XinnnCfszGNv3RBB8FhTuE3nd3nTkBQP2V/ZC7rdKLSZqoFgK72lVWNGadd3Amf9j4b8Hdm4fwIGK3sLMgKWrABZIq28t8YjFSEJY0nb4F4+MN4zGo2msZlyQr4nU9PshzxgQzg2fnd7ghUP3xi+ofam4N3eM335ZVYFg2oWEnkm6xQungtFzRu+bncOjiaqxwi5g71qS1eLXzxD33zfOwtEqaV6jxFxdvD8PnZxJqP0bkyIsySWP67FclJmDK8x53T3IaUfk6Rec0uGXW6GLct48WyxIhAtCsnGxx8yDlqygqBZJ+AAYJ16GmMR9c4qgL8RimyfMIiowUvBpOwGwhWrY4JPVkCDMF5okXDXmDxuxqcPmx9rOAMTIqloLCEzuXvJkx3BuGPxEc6wd83MkejRC6JY5znSPBJ39YQEh5nLiRz94YGxOMnxNPWjEWmYrpPUNeHPQHVKYxMMh2h0UnrspNFZIRz8cU7zCxqXjoQTB091eTJhSL/ezsMzLD57VVrcU0TzxQjRge2gU9aEhwE/oSK27jZwDi7CUcBhpiIcJdXCzUutZb23HBiPyiE0yIQlthFFsYxPdTamc+ol40SmcWIHnIAHlUtlv/E5bfMuyhya+oQpM8U5s1IX/v9OpnJnjV/EaQ== damien.ramelet@protonmail.com" > id_rsa.pub

      - name: Deploy to production
        run: |
          ssh -tto StrictHostKeyChecking=no damien@51.159.190.2
          "cd OC-P8 && git pull origin master && pipenv shell && python manage.py collectstatic --noinput && python manage.py makemigrations && python manage.py migrate && exit"


